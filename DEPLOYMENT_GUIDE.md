# üöÄ Deployment Guide - Smile Clinic CRM

## –ü–æ—à–∞–≥–æ–≤–∞—è –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏—è –ø–æ —Ä–∞–∑–≤–µ—Ä—Ç—ã–≤–∞–Ω–∏—é –≤ production

---

## üìã –ü—Ä–µ–¥–≤–∞—Ä–∏—Ç–µ–ª—å–Ω—ã–µ —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è

- [x] –ê–∫–∫–∞—É–Ω—Ç Supabase (https://supabase.com)
- [x] Node.js 18+ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω
- [x] Git —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω
- [x] –î–æ—Å—Ç—É–ø –∫ –ø—Ä–æ–µ–∫—Ç—É –Ω–∞ GitHub (DentShare/smile-clinic-crm)

---

## üóÑÔ∏è –®–∞–≥ 1: –ù–∞—Å—Ç—Ä–æ–π–∫–∞ Supabase Backend

### 1.1 –ó–∞–ø—É—Å–∫ –º–∏–≥—Ä–∞—Ü–∏–π –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö

1. **–û—Ç–∫—Ä–æ–π—Ç–µ Supabase Dashboard** ‚Üí –í–∞—à –ø—Ä–æ–µ–∫—Ç ‚Üí SQL Editor

2. **–í—ã–ø–æ–ª–Ω–∏—Ç–µ –º–∏–≥—Ä–∞—Ü–∏–∏ –ø–æ –ø–æ—Ä—è–¥–∫—É:**

#### –ú–∏–≥—Ä–∞—Ü–∏—è 001: –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å –∏ –∞—É–¥–∏—Ç
```bash
# –û—Ç–∫—Ä–æ–π—Ç–µ —Ñ–∞–π–ª: supabase/migrations/001_add_security_columns.sql
# –°–∫–æ–ø–∏—Ä—É–π—Ç–µ –≤–µ—Å—å –∫–æ–¥ –∏ –≤—ã–ø–æ–ª–Ω–∏—Ç–µ –≤ SQL Editor
```

**–ß—Ç–æ —Å–æ–∑–¥–∞–µ—Ç—Å—è:**
- ‚úÖ –ö–æ–ª–æ–Ω–∫–∞ `idempotency_key` –≤ —Ç–∞–±–ª–∏—Ü–µ payments
- ‚úÖ –¢–∞–±–ª–∏—Ü–∞ `audit_log` –¥–ª—è –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è –≤—Å–µ—Ö –æ–ø–µ—Ä–∞—Ü–∏–π
- ‚úÖ –¢–∞–±–ª–∏—Ü–∞ `fraud_alerts` –¥–ª—è –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞ –ø–æ–¥–æ–∑—Ä–∏—Ç–µ–ª—å–Ω–æ–π –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏
- ‚úÖ RLS –ø–æ–ª–∏—Ç–∏–∫–∏ –¥–ª—è audit_log –∏ fraud_alerts
- ‚úÖ Helper —Ñ—É–Ω–∫—Ü–∏—è `log_audit_event()`

#### –ú–∏–≥—Ä–∞—Ü–∏—è 002: RPC —Ñ—É–Ω–∫—Ü–∏–∏ —Å –≤–∞–ª–∏–¥–∞—Ü–∏–µ–π
```bash
# –û—Ç–∫—Ä–æ–π—Ç–µ —Ñ–∞–π–ª: supabase/migrations/002_create_payment_rpc_functions.sql
# –°–∫–æ–ø–∏—Ä—É–π—Ç–µ –≤–µ—Å—å –∫–æ–¥ –∏ –≤—ã–ø–æ–ª–Ω–∏—Ç–µ –≤ SQL Editor
```

**–ß—Ç–æ —Å–æ–∑–¥–∞–µ—Ç—Å—è:**
- ‚úÖ `is_super_admin()` - –ø—Ä–æ–≤–µ—Ä–∫–∞ –ø—Ä–∞–≤ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞
- ‚úÖ `verify_clinic_access()` - –ø—Ä–æ–≤–µ—Ä–∫–∞ –¥–æ—Å—Ç—É–ø–∞ –∫ –∫–ª–∏–Ω–∏–∫–µ
- ‚úÖ `process_patient_payment()` - –æ–±—Ä–∞–±–æ—Ç–∫–∞ –ø–ª–∞—Ç–µ–∂–µ–π —Å –ø–æ–ª–Ω–æ–π –≤–∞–ª–∏–¥–∞—Ü–∏–µ–π
- ‚úÖ `process_bonus_payment()` - —Å–ø–∏—Å–∞–Ω–∏–µ –±–æ–Ω—É—Å–æ–≤ —Å –ø—Ä–æ–≤–µ—Ä–∫–æ–π –±–∞–ª–∞–Ω—Å–∞
- ‚úÖ `process_deposit_payment()` - –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –¥–µ–ø–æ–∑–∏—Ç–∞ —Å –ø—Ä–æ–≤–µ—Ä–∫–æ–π

#### –ú–∏–≥—Ä–∞—Ü–∏—è 003: Row Level Security (RLS)
```bash
# –û—Ç–∫—Ä–æ–π—Ç–µ —Ñ–∞–π–ª: supabase/migrations/003_setup_row_level_security.sql
# –°–∫–æ–ø–∏—Ä—É–π—Ç–µ –≤–µ—Å—å –∫–æ–¥ –∏ –≤—ã–ø–æ–ª–Ω–∏—Ç–µ –≤ SQL Editor
```

**–ß—Ç–æ —Å–æ–∑–¥–∞–µ—Ç—Å—è:**
- ‚úÖ RLS –ø–æ–ª–∏—Ç–∏–∫–∏ –¥–ª—è –≤—Å–µ—Ö –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏—Ö —Ç–∞–±–ª–∏—Ü
- ‚úÖ –ò–∑–æ–ª—è—Ü–∏—è –¥–∞–Ω–Ω—ã—Ö –º–µ–∂–¥—É –∫–ª–∏–Ω–∏–∫–∞–º–∏
- ‚úÖ –†–æ–ª—å-based access control (RBAC)
- ‚úÖ –ó–∞—â–∏—Ç–∞ –æ—Ç –Ω–µ—Å–∞–Ω–∫—Ü–∏–æ–Ω–∏—Ä–æ–≤–∞–Ω–Ω–æ–≥–æ –¥–æ—Å—Ç—É–ø–∞

#### –ú–∏–≥—Ä–∞—Ü–∏—è 004: Fraud Detection
```bash
# –û—Ç–∫—Ä–æ–π—Ç–µ —Ñ–∞–π–ª: supabase/migrations/004_fraud_detection_triggers.sql
# –°–∫–æ–ø–∏—Ä—É–π—Ç–µ –≤–µ—Å—å –∫–æ–¥ –∏ –≤—ã–ø–æ–ª–Ω–∏—Ç–µ –≤ SQL Editor
```

**–ß—Ç–æ —Å–æ–∑–¥–∞–µ—Ç—Å—è:**
- ‚úÖ –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –æ–±–Ω–∞—Ä—É–∂–µ–Ω–∏–µ –º–Ω–æ–∂–µ—Å—Ç–≤–µ–Ω–Ω—ã—Ö –∫—Ä—É–ø–Ω—ã—Ö –ø–ª–∞—Ç–µ–∂–µ–π
- ‚úÖ –ê–ª–µ—Ä—Ç—ã –Ω–∞ –ø–ª–∞—Ç–µ–∂–∏ –≤ –Ω–µ—Ä–∞–±–æ—á–µ–µ –≤—Ä–µ–º—è
- ‚úÖ –î–µ—Ç–µ–∫—Ü–∏—è –ø–æ–¥–æ–∑—Ä–∏—Ç–µ–ª—å–Ω—ã—Ö –ø–∞—Ç—Ç–µ—Ä–Ω–æ–≤
- ‚úÖ –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –±—ã—Å—Ç—Ä—ã—Ö –ø–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω—ã—Ö —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–π
- ‚úÖ HIPAA-—Å–æ–≤–º–µ—Å—Ç–∏–º–æ–µ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –¥–æ—Å—Ç—É–ø–∞ –∫ –¥–∞–Ω–Ω—ã–º –ø–∞—Ü–∏–µ–Ω—Ç–æ–≤

### 1.2 –ü—Ä–æ–≤–µ—Ä–∫–∞ –º–∏–≥—Ä–∞—Ü–∏–π

–ü–æ—Å–ª–µ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è –≤—Å–µ—Ö –º–∏–≥—Ä–∞—Ü–∏–π –ø—Ä–æ–≤–µ—Ä—å—Ç–µ:

```sql
-- –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —á—Ç–æ –≤—Å–µ —Ç–∞–±–ª–∏—Ü—ã —Å–æ–∑–¥–∞–Ω—ã
SELECT table_name
FROM information_schema.tables
WHERE table_schema = 'public'
AND table_name IN ('audit_log', 'fraud_alerts');

-- –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —á—Ç–æ RLS –≤–∫–ª—é—á–µ–Ω
SELECT tablename, rowsecurity
FROM pg_tables
WHERE schemaname = 'public'
AND tablename IN ('payments', 'patients', 'clinics');

-- –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —á—Ç–æ —Ñ—É–Ω–∫—Ü–∏–∏ —Å–æ–∑–¥–∞–Ω—ã
SELECT routine_name
FROM information_schema.routines
WHERE routine_schema = 'public'
AND routine_name IN ('process_patient_payment', 'is_super_admin', 'log_audit_event');
```

–û–∂–∏–¥–∞–µ–º—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç:
- ‚úÖ 2 –Ω–æ–≤—ã–µ —Ç–∞–±–ª–∏—Ü—ã (audit_log, fraud_alerts)
- ‚úÖ RLS –≤–∫–ª—é—á–µ–Ω –Ω–∞ –≤—Å–µ—Ö –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏—Ö —Ç–∞–±–ª–∏—Ü–∞—Ö (rowsecurity = true)
- ‚úÖ 6+ –Ω–æ–≤—ã—Ö —Ñ—É–Ω–∫—Ü–∏–π —Å–æ–∑–¥–∞–Ω—ã

---

## üíª –®–∞–≥ 2: –ù–∞—Å—Ç—Ä–æ–π–∫–∞ Frontend

### 2.1 –ö–ª–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ –∏ —É—Å—Ç–∞–Ω–æ–≤–∫–∞

```bash
# –ö–ª–æ–Ω–∏—Ä—É–π—Ç–µ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π
git clone https://github.com/DentShare/smile-clinic-crm.git
cd smile-clinic-crm

# –£—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏
npm install
```

### 2.2 –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö –æ–∫—Ä—É–∂–µ–Ω–∏—è

```bash
# –£–±–µ–¥–∏—Ç–µ—Å—å —á—Ç–æ —Ñ–∞–π–ª .env —Å—É—â–µ—Å—Ç–≤—É–µ—Ç –∏ –∑–∞–ø–æ–ª–Ω–µ–Ω
# –ï—Å–ª–∏ –Ω–µ—Ç - —Å–æ–∑–¥–∞–π—Ç–µ –Ω–∞ –æ—Å–Ω–æ–≤–µ .env.example
cp .env.example .env
```

–û—Ç—Ä–µ–¥–∞–∫—Ç–∏—Ä—É–π—Ç–µ `.env`:
```env
VITE_SUPABASE_URL=https://your-project.supabase.co
VITE_SUPABASE_PUBLISHABLE_KEY=your-anon-key
```

**–ì–¥–µ –≤–∑—è—Ç—å credentials:**
1. Supabase Dashboard ‚Üí Settings ‚Üí API
2. –°–∫–æ–ø–∏—Ä—É–π—Ç–µ `Project URL` ‚Üí VITE_SUPABASE_URL
3. –°–∫–æ–ø–∏—Ä—É–π—Ç–µ `anon/public` key ‚Üí VITE_SUPABASE_PUBLISHABLE_KEY

### 2.3 –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –ª–æ–∫–∞–ª—å–Ω–æ

```bash
# –ó–∞–ø—É—Å—Ç–∏—Ç–µ dev —Å–µ—Ä–≤–µ—Ä
npm run dev

# –û—Ç–∫—Ä–æ–π—Ç–µ http://localhost:5173
```

**–ü—Ä–æ–≤–µ—Ä—å—Ç–µ:**
- ‚úÖ –°—Ç—Ä–∞–Ω–∏—Ü–∞ –ª–æ–≥–∏–Ω–∞ –∑–∞–≥—Ä—É–∂–∞–µ—Ç—Å—è
- ‚úÖ –ù–µ—Ç –æ—à–∏–±–æ–∫ –≤ –∫–æ–Ω—Å–æ–ª–∏ –±—Ä–∞—É–∑–µ—Ä–∞
- ‚úÖ –ú–æ–∂–Ω–æ –∑–∞–ª–æ–≥–∏–Ω–∏—Ç—å—Å—è (–µ—Å–ª–∏ –µ—Å—Ç—å —Ç–µ—Å—Ç–æ–≤—ã–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å)

---

## üîê –®–∞–≥ 3: –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏

### 3.1 –¢–µ—Å—Ç –ø–ª–∞—Ç–µ–∂–µ–π —Å idempotency

1. –°–æ–∑–¥–∞–π—Ç–µ —Ç–µ—Å—Ç–æ–≤–æ–≥–æ –ø–∞—Ü–∏–µ–Ω—Ç–∞
2. –û—Ç–∫—Ä–æ–π—Ç–µ DevTools ‚Üí Network tab
3. –û–±—Ä–∞–±–æ—Ç–∞–π—Ç–µ –ø–ª–∞—Ç–µ–∂
4. –ë—ã—Å—Ç—Ä–æ –Ω–∞–∂–º–∏—Ç–µ –∫–Ω–æ–ø–∫—É "–ü—Ä–∏–Ω—è—Ç—å" 2-3 —Ä–∞–∑–∞
5. **–û–∂–∏–¥–∞–µ–º—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç:** –¢–æ–ª—å–∫–æ –æ–¥–∏–Ω –ø–ª–∞—Ç–µ–∂ —Å–æ–∑–¥–∞–Ω, –æ—Å—Ç–∞–ª—å–Ω—ã–µ –∑–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω—ã

### 3.2 –¢–µ—Å—Ç –≤–∞–ª–∏–¥–∞—Ü–∏–∏ —Å—É–º–º

–ü–æ–ø—Ä–æ–±—É–π—Ç–µ —Å–æ–∑–¥–∞—Ç—å –ø–ª–∞—Ç–µ–∂ —Å:
- ‚ùå –û—Ç—Ä–∏—Ü–∞—Ç–µ–ª—å–Ω–æ–π —Å—É–º–º–æ–π ‚Üí –î–æ–ª–∂–Ω–∞ –±—ã—Ç—å –∑–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω–∞
- ‚ùå –°—É–º–º–æ–π > 100,000,000 ‚Üí –î–æ–ª–∂–Ω–∞ –±—ã—Ç—å –∑–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω–∞
- ‚ùå –ù—É–ª–µ–≤–æ–π —Å—É–º–º–æ–π ‚Üí –î–æ–ª–∂–Ω–∞ –±—ã—Ç—å –∑–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω–∞
- ‚úÖ –ù–æ—Ä–º–∞–ª—å–Ω–æ–π —Å—É–º–º–æ–π (1,000 - 10,000,000) ‚Üí –î–æ–ª–∂–Ω–∞ –ø—Ä–æ–π—Ç–∏

### 3.3 –¢–µ—Å—Ç –∏–∑–æ–ª—è—Ü–∏–∏ –¥–∞–Ω–Ω—ã—Ö –∫–ª–∏–Ω–∏–∫

1. –°–æ–∑–¥–∞–π—Ç–µ 2 –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –≤ —Ä–∞–∑–Ω—ã—Ö –∫–ª–∏–Ω–∏–∫–∞—Ö
2. –ó–∞–ª–æ–≥–∏–Ω—å—Ç–µ—Å—å –∫–∞–∫ User A
3. –ü–æ–ø—Ä–æ–±—É–π—Ç–µ –ø–æ–ª—É—á–∏—Ç—å –¥–æ—Å—Ç—É–ø –∫ –¥–∞–Ω–Ω—ã–º User B —á–µ—Ä–µ–∑ DevTools/API
4. **–û–∂–∏–¥–∞–µ–º—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç:** –î–æ—Å—Ç—É–ø –∑–∞–ø—Ä–µ—â–µ–Ω RLS –ø–æ–ª–∏—Ç–∏–∫–∞–º–∏

### 3.4 –¢–µ—Å—Ç fraud detection

–ü—Ä–æ–≤–µ—Ä—å—Ç–µ –≤ —Ç–∞–±–ª–∏—Ü–µ `fraud_alerts`:

```sql
-- –ü–æ—Å–º–æ—Ç—Ä–∏—Ç–µ –≤—Å–µ –∞–ª–µ—Ä—Ç—ã
SELECT * FROM fraud_alerts ORDER BY created_at DESC LIMIT 10;
```

–°–æ–∑–¥–∞–π—Ç–µ —Ç–µ—Å—Ç–æ–≤—ã–µ —Å—Ü–µ–Ω–∞—Ä–∏–∏:
- –ù–µ—Å–∫–æ–ª—å–∫–æ –∫—Ä—É–ø–Ω—ã—Ö –ø–ª–∞—Ç–µ–∂–µ–π –ø–æ–¥—Ä—è–¥ (>1,000,000)
- –ü–ª–∞—Ç–µ–∂ –≤ 2 —á–∞—Å–∞ –Ω–æ—á–∏
- –ü–ª–∞—Ç–µ–∂ –Ω–∞ —Å—É–º–º—É 5,000,000 (—Ä–æ–≤–Ω–æ–µ —á–∏—Å–ª–æ)

**–û–∂–∏–¥–∞–µ–º—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç:** –í —Ç–∞–±–ª–∏—Ü–µ `fraud_alerts` –ø–æ—è–≤—è—Ç—Å—è –∑–∞–ø–∏—Å–∏

---

## üåê –®–∞–≥ 4: –î–µ–ø–ª–æ–π –Ω–∞ Production

### –í–∞—Ä–∏–∞–Ω—Ç A: Netlify (—Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è)

1. **–ü–æ–¥–∫–ª—é—á–∏—Ç–µ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π:**
   - –ü–µ—Ä–µ–π–¥–∏—Ç–µ –Ω–∞ https://app.netlify.com
   - New site from Git ‚Üí GitHub ‚Üí –≤—ã–±–µ—Ä–∏—Ç–µ smile-clinic-crm

2. **–ù–∞—Å—Ç—Ä–æ–π—Ç–µ build settings:**
   ```
   Build command: npm run build
   Publish directory: dist
   ```

3. **–î–æ–±–∞–≤—å—Ç–µ environment variables:**
   - Site settings ‚Üí Environment variables
   - –î–æ–±–∞–≤—å—Ç–µ `VITE_SUPABASE_URL` –∏ `VITE_SUPABASE_PUBLISHABLE_KEY`

4. **Deploy!**
   - –ù–∞–∂–º–∏—Ç–µ "Deploy site"
   - –î–æ–∂–¥–∏—Ç–µ—Å—å –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è (2-3 –º–∏–Ω—É—Ç—ã)

### –í–∞—Ä–∏–∞–Ω—Ç B: Vercel

1. **–ü–æ–¥–∫–ª—é—á–∏—Ç–µ –ø—Ä–æ–µ–∫—Ç:**
   ```bash
   npm install -g vercel
   vercel login
   vercel
   ```

2. **–ù–∞—Å—Ç—Ä–æ–π—Ç–µ environment variables:**
   ```bash
   vercel env add VITE_SUPABASE_URL production
   vercel env add VITE_SUPABASE_PUBLISHABLE_KEY production
   ```

3. **Deploy:**
   ```bash
   vercel --prod
   ```

### –í–∞—Ä–∏–∞–Ω—Ç C: Custom VPS

```bash
# –ù–∞ —Å–µ—Ä–≤–µ—Ä–µ
git clone https://github.com/DentShare/smile-clinic-crm.git
cd smile-clinic-crm

# –£—Å—Ç–∞–Ω–æ–≤–∫–∞
npm install
npm run build

# –ù–∞—Å—Ç—Ä–æ–π–∫–∞ Nginx
sudo nano /etc/nginx/sites-available/smile-crm

# –î–æ–±–∞–≤—å—Ç–µ –∫–æ–Ω—Ñ–∏–≥:
server {
    listen 80;
    server_name your-domain.com;
    root /path/to/smile-clinic-crm/dist;
    index index.html;

    location / {
        try_files $uri $uri/ /index.html;
    }
}

# –ê–∫—Ç–∏–≤–∏—Ä—É–π—Ç–µ
sudo ln -s /etc/nginx/sites-available/smile-crm /etc/nginx/sites-enabled/
sudo nginx -t
sudo systemctl reload nginx

# –£—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ SSL (Let's Encrypt)
sudo certbot --nginx -d your-domain.com
```

---

## üìä –®–∞–≥ 5: –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –∏ –æ–±—Å–ª—É–∂–∏–≤–∞–Ω–∏–µ

### 5.1 –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞ Supabase

1. **Dashboard ‚Üí Settings ‚Üí Alerts**
   - –í–∫–ª—é—á–∏—Ç–µ email alerts –¥–ª—è –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏—Ö —Å–æ–±—ã—Ç–∏–π
   - –ù–∞—Å—Ç—Ä–æ–π—Ç–µ –ª–∏–º–∏—Ç—ã –Ω–∞ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –∑–∞–ø—Ä–æ—Å–æ–≤

2. **–†–µ–≥—É–ª—è—Ä–Ω—ã–µ –ø—Ä–æ–≤–µ—Ä–∫–∏:**
   ```sql
   -- –ü—Ä–æ–≤–µ—Ä–∫–∞ fraud alerts (–µ–∂–µ–¥–Ω–µ–≤–Ω–æ)
   SELECT
     alert_type,
     severity,
     COUNT(*) as count
   FROM fraud_alerts
   WHERE created_at > NOW() - INTERVAL '24 hours'
   AND resolved = false
   GROUP BY alert_type, severity;

   -- –ü—Ä–æ–≤–µ—Ä–∫–∞ audit log (–µ–∂–µ–Ω–µ–¥–µ–ª—å–Ω–æ)
   SELECT
     action,
     COUNT(*) as count
   FROM audit_log
   WHERE created_at > NOW() - INTERVAL '7 days'
   GROUP BY action
   ORDER BY count DESC;
   ```

### 5.2 Backup —Å—Ç—Ä–∞—Ç–µ–≥–∏—è

```sql
-- –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π backup –≤ Supabase
-- Dashboard ‚Üí Database ‚Üí Backups
-- –ù–∞—Å—Ç—Ä–æ–π—Ç–µ daily backups —Å retention 7 –¥–Ω–µ–π

-- –î–ª—è –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏—Ö –¥–∞–Ω–Ω—ã—Ö - —Å–æ–∑–¥–∞–π—Ç–µ manual snapshots:
-- Dashboard ‚Üí Database ‚Üí Backups ‚Üí Create backup
```

### 5.3 Performance –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥

```sql
-- –ú–µ–¥–ª–µ–Ω–Ω—ã–µ –∑–∞–ø—Ä–æ—Å—ã (–≤—ã–ø–æ–ª–Ω—è—Ç—å —Ä–∞–∑ –≤ –Ω–µ–¥–µ–ª—é)
SELECT
  query,
  calls,
  mean_exec_time,
  max_exec_time
FROM pg_stat_statements
WHERE mean_exec_time > 100 -- > 100ms
ORDER BY mean_exec_time DESC
LIMIT 20;
```

---

## üîÑ –®–∞–≥ 6: –û–±–Ω–æ–≤–ª–µ–Ω–∏—è –∏ rollback

### –ü—Ä–∏–º–µ–Ω–µ–Ω–∏–µ –Ω–æ–≤—ã—Ö –º–∏–≥—Ä–∞—Ü–∏–π

```bash
# –ü—Ä–∏ –ø–æ–ª—É—á–µ–Ω–∏–∏ –Ω–æ–≤—ã—Ö –º–∏–≥—Ä–∞—Ü–∏–π:
git pull origin main
# –û—Ç–∫—Ä–æ–π—Ç–µ –Ω–æ–≤—ã–µ —Ñ–∞–π–ª—ã –≤ supabase/migrations/
# –í—ã–ø–æ–ª–Ω–∏—Ç–µ –∏—Ö –≤ SQL Editor –ø–æ –ø–æ—Ä—è–¥–∫—É
```

### Rollback –≤ —Å–ª—É—á–∞–µ –ø—Ä–æ–±–ª–µ–º

```sql
-- –û—Ç–∫–∞—Ç–∏—Ç—å –ø–æ—Å–ª–µ–¥–Ω—é—é –º–∏–≥—Ä–∞—Ü–∏—é (–ø—Ä–∏–º–µ—Ä)
-- –í–ù–ò–ú–ê–ù–ò–ï: –¥–µ–ª–∞–π—Ç–µ backup –ø–µ—Ä–µ–¥ rollback!

-- 1. –£–¥–∞–ª–∏—Ç—å —Å–æ–∑–¥–∞–Ω–Ω—ã–µ —Ç—Ä–∏–≥–≥–µ—Ä—ã
DROP TRIGGER IF EXISTS trigger_name ON table_name;

-- 2. –£–¥–∞–ª–∏—Ç—å —Å–æ–∑–¥–∞–Ω–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏
DROP FUNCTION IF EXISTS function_name;

-- 3. –£–¥–∞–ª–∏—Ç—å —Å–æ–∑–¥–∞–Ω–Ω—ã–µ —Ç–∞–±–ª–∏—Ü—ã (–û–°–¢–û–†–û–ñ–ù–û!)
DROP TABLE IF EXISTS table_name CASCADE;

-- 4. –í–æ—Å—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –∏–∑ backup
-- Dashboard ‚Üí Database ‚Üí Backups ‚Üí Restore
```

---

## üÜò Troubleshooting

### –ü—Ä–æ–±–ª–µ–º–∞: "Missing environment variables"

**–†–µ—à–µ–Ω–∏–µ:**
```bash
# –£–±–µ–¥–∏—Ç–µ—Å—å —á—Ç–æ .env —Ñ–∞–π–ª —Å—É—â–µ—Å—Ç–≤—É–µ—Ç
ls -la .env

# –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —Å–æ–¥–µ—Ä–∂–∏–º–æ–µ
cat .env

# –ü–µ—Ä–µ—Å–æ–∑–¥–∞–π—Ç–µ –µ—Å–ª–∏ –Ω—É–∂–Ω–æ
cp .env.example .env
nano .env
```

### –ü—Ä–æ–±–ª–µ–º–∞: RPC —Ñ—É–Ω–∫—Ü–∏—è –Ω–µ –Ω–∞–π–¥–µ–Ω–∞

**–†–µ—à–µ–Ω–∏–µ:**
```sql
-- –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —á—Ç–æ —Ñ—É–Ω–∫—Ü–∏—è —Å–æ–∑–¥–∞–Ω–∞
SELECT routine_name FROM information_schema.routines
WHERE routine_schema = 'public'
AND routine_name = 'process_patient_payment';

-- –ï—Å–ª–∏ –Ω–µ –Ω–∞–π–¥–µ–Ω–∞ - –≤—ã–ø–æ–ª–Ω–∏—Ç–µ –º–∏–≥—Ä–∞—Ü–∏—é 002 –∑–∞–Ω–æ–≤–æ
```

### –ü—Ä–æ–±–ª–µ–º–∞: RLS –±–ª–æ–∫–∏—Ä—É–µ—Ç –∑–∞–ø—Ä–æ—Å—ã

**–†–µ—à–µ–Ω–∏–µ:**
```sql
-- –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ø–æ–ª–∏—Ç–∏–∫–∏
SELECT schemaname, tablename, policyname, permissive, roles, cmd
FROM pg_policies
WHERE tablename = 'payments';

-- –í—Ä–µ–º–µ–Ω–Ω–æ –æ—Ç–∫–ª—é—á–∏—Ç–µ RLS –¥–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è (—Ç–æ–ª—å–∫–æ –≤ dev!)
ALTER TABLE payments DISABLE ROW LEVEL SECURITY;
-- –ù–µ –∑–∞–±—É–¥—å—Ç–µ –≤–∫–ª—é—á–∏—Ç—å –æ–±—Ä–∞—Ç–Ω–æ!
ALTER TABLE payments ENABLE ROW LEVEL SECURITY;
```

### –ü—Ä–æ–±–ª–µ–º–∞: Fraud alerts –Ω–µ —Å–æ–∑–¥–∞—é—Ç—Å—è

**–†–µ—à–µ–Ω–∏–µ:**
```sql
-- –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —á—Ç–æ —Ç—Ä–∏–≥–≥–µ—Ä—ã —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω—ã
SELECT trigger_name, event_manipulation, event_object_table
FROM information_schema.triggers
WHERE event_object_schema = 'public';

-- –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ø—Ä–∞–≤–∞ –Ω–∞ —Ç–∞–±–ª–∏—Ü—É fraud_alerts
SELECT grantee, privilege_type
FROM information_schema.role_table_grants
WHERE table_name='fraud_alerts';
```

---

## ‚úÖ Production Checklist

–ü–µ—Ä–µ–¥ –∑–∞–ø—É—Å–∫–æ–º –≤ production —É–±–µ–¥–∏—Ç–µ—Å—å:

### –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å
- [ ] `.env` —Ñ–∞–π–ª –≤ `.gitignore`
- [ ] –í—Å–µ –ø–∞—Ä–æ–ª–∏ —Å–ª–æ–∂–Ω—ã–µ (12+ —Å–∏–º–≤–æ–ª–æ–≤)
- [ ] RLS –≤–∫–ª—é—á–µ–Ω –Ω–∞ –≤—Å–µ—Ö —Ç–∞–±–ª–∏—Ü–∞—Ö
- [ ] Audit logging —Ä–∞–±–æ—Ç–∞–µ—Ç
- [ ] Fraud detection —Ç—Ä–∏–≥–≥–µ—Ä—ã –∞–∫—Ç–∏–≤–Ω—ã

### –§—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç—å
- [ ] –í—Å–µ –º–∏–≥—Ä–∞—Ü–∏–∏ –ø—Ä–∏–º–µ–Ω–µ–Ω—ã
- [ ] –ü–ª–∞—Ç–µ–∂–∏ –ø—Ä–æ—Ö–æ–¥—è—Ç —É—Å–ø–µ—à–Ω–æ
- [ ] Idempotency —Ä–∞–±–æ—Ç–∞–µ—Ç
- [ ] –ë–æ–Ω—É—Å—ã –∏ –¥–µ–ø–æ–∑–∏—Ç—ã —Å–ø–∏—Å—ã–≤–∞—é—Ç—Å—è –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ
- [ ] N+1 –∑–∞–ø—Ä–æ—Å—ã –∏—Å–ø—Ä–∞–≤–ª–µ–Ω—ã

### –ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å
- [ ] Build –ø—Ä–æ—Ö–æ–¥–∏—Ç –±–µ–∑ –æ—à–∏–±–æ–∫
- [ ] –°—Ç—Ä–∞–Ω–∏—Ü—ã –∑–∞–≥—Ä—É–∂–∞—é—Ç—Å—è < 3 —Å–µ–∫—É–Ω–¥
- [ ] –ù–µ—Ç memory leaks
- [ ] –ò–Ω–¥–µ–∫—Å—ã —Å–æ–∑–¥–∞–Ω—ã –Ω–∞ —á–∞—Å—Ç–æ –∑–∞–ø—Ä–∞—à–∏–≤–∞–µ–º—ã—Ö –ø–æ–ª—è—Ö

### –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥
- [ ] Email alerts –Ω–∞—Å—Ç—Ä–æ–µ–Ω—ã –≤ Supabase
- [ ] Backup –≤–∫–ª—é—á–µ–Ω (daily)
- [ ] Error tracking –Ω–∞—Å—Ç—Ä–æ–µ–Ω (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ: Sentry)
- [ ] Analytics –ø–æ–¥–∫–ª—é—á–µ–Ω–∞ (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ: Google Analytics)

### –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è
- [ ] SECURITY_RECOMMENDATIONS.md –ø—Ä–æ—á–∏—Ç–∞–Ω
- [ ] FIXES_SUMMARY.md –∏–∑—É—á–µ–Ω
- [ ] –ö–æ–º–∞–Ω–¥–∞ –∑–Ω–∞–µ—Ç –∫–∞–∫ –ø—Ä–æ–≤–µ—Ä—è—Ç—å fraud_alerts
- [ ] –ü—Ä–æ—Ü–µ–¥—É—Ä–∞ rollback –∑–∞–¥–æ–∫—É–º–µ–Ω—Ç–∏—Ä–æ–≤–∞–Ω–∞

---

## üìû –ü–æ–¥–¥–µ—Ä–∂–∫–∞

–ï—Å–ª–∏ –≤–æ–∑–Ω–∏–∫–ª–∏ –ø—Ä–æ–±–ª–µ–º—ã:
1. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —Ä–∞–∑–¥–µ–ª Troubleshooting –≤—ã—à–µ
2. –ü–æ—Å–º–æ—Ç—Ä–∏—Ç–µ –ª–æ–≥–∏ –≤ Supabase Dashboard ‚Üí Logs
3. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ Browser Console –Ω–∞ –æ—à–∏–±–∫–∏
4. –°–æ–∑–¥–∞–π—Ç–µ Issue –≤ GitHub —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–∏

---

**–î–∞—Ç–∞ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è:** 2026-02-13
**–í–µ—Ä—Å–∏—è:** 1.0.0
**–°—Ç–∞—Ç—É—Å:** ‚úÖ –ì–æ—Ç–æ–≤–æ –∫ production deployment
